import os
import requests
from bs4 import BeautifulSoup
#os.chdir('/root/poc_detection/datasets/MALWAREbazaar')
query_url = 'https://bazaar.abuse.ch/browse.php?search=file_type%3Aexe'
pre_download_url = 'https://bazaar.abuse.ch'
# page = requests.get(nist + c)
#             soup = BeautifulSoup(page.text,'html.parser')
#             desc = soup.find("p", {"data-testid":"vuln-description"}).text

page = requests.get(query_url)
soup = BeautifulSoup(page.text,features="html.parser")
for row in soup.find_all('tr'):
    for a in row.find_all('a'):
        if 'download' in a['href']:
            req = requests.get(pre_download_url + a['href'])
            downloadsoup = BeautifulSoup(req.text,'html.parser')
            print(downloadsoup.find_all('button'))
            # TODO find download button and use snippet at https://stackoverflow.com/questions/33538600/how-to-automatically-download-the-files-that-have-a-download-button-on-a-webpage
            #button = downloadsoup.find('button')
            #print(button)
            #print(a['href'])
#print(soup.prettify)